language: node_js
node_js: 8
install:
- yarn
- cd functions && yarn && cd ..
cache:
  directories:
  - node_modules
  - functions/node_modules

jobs:
  include:
    # - stage: Tests
    #   name: Eslint
    #   script: yarn lint
    - stage: Tests
      name: Unit tests
      script: yarn test && yarn codacy
      env:
        # CODACY_PROJECT_TOKEN
        secure: QQYzYwWpv8WSnScsM8V6fnYMT7A4EWAFHkX8AFl1lDhArY7WtuJozs9Uy9937yR6SzEwkifUQvRoIud/wsYbRuXfzhgwKW0VA0DlW0CnGH9DVPHw9PkKfDjyq89FybD2K0QGWUsZbHQ5AYCbbiql0OhX2MPQi8mj9QlHlA8ftd1KaPHwx5suDIrE9qH9aBarVWrJzNtqetRxj8F60Hq/oG9FmeYD7NLi/rUo+xI0k6/C1wwEF7rHq/u3FCCFaZ9fCh6D09Vz0SBzhami4PZAnhCajY2iqdg33uT8O4W87yQcHScZbeZQiq09FPlA1RibnCC1ImnVOaZmyT+hge7/ndU/tJYzAif6FIrFjNqrF/QdmbH+ZKS2nunfD8iAmJ1vs8+ZsmEholSc7yK70ZvyfRWU1l5ZqIsbm6EUloXAazMAB7FirG5vMSvZThQt0Qu4yVXY5QqqcCXfoPylpeO2+IO/+C/8fVALxYP78HlzJinm5/T3ur6HQkpikEuhtFnMH/xaSoUWHXYPiVA23nmnVOYXwgQaJmYtXjU/zo2GcdKQ920sDIben0LfXgeFSpwrsASLNXYqnHvEh6qcisF93z/3VmBz/NSdpSpbKsOfuqpdLFlqynr/8VI9DjELrQBU0f2PSaFTLrjUsK/NwfSLnB68c7iQWTyAc9ZetM/24So=

    - stage: Build
      name: Build Dev
      if: branch != master
      script: yarn build
      env:
        # FIREBASE_API_KEY
        - secure: oTxW7FJjKJ1RtI+ViJFGI+agRgLbkVqBdDBlTLfXnrcBv0PYj47AFn8KLoL/XHXF7JA7knBSZEzaTeVK9mqvzpzIOQARE9ChkVXfHFW1HvHju4NSvSc2cv6ItQXhTf2RasvIni/fscUG7E9UDlrDucnhs6AzUM34ByA1xN3KNSLixuwDljN8gUuQQ5Pim3ig7cCGLAnE2O0yLuAUAomVlWPCEDgYaH17XuHEy40kSrxHAYga2634RmE5IjAqyl2vs1i5uQiDrrXEkf2RazHDR9wuKRYDvCZRKzTwTqDWOKCpURzgWQdwgZpVa7QMmV0JIgJOBx2PN4wS0FybA+gWuJDnymZXfpgbZClvt1sezMTExFB7qA9pWFAZihKCN6Una1SA0QGPLh4RcUcV/VOHJGvaaZSaIvSrEhkXGjNJoq8naK/G/5dWP8VcLBblY//4PQfHuVphyw3dipRE2W+TKAKpuMQNZIT0qugBowASlzJXmGHH2m+YwOMi+6jy1q/3m27fnijbNMRiida6ryvhnbSeK5atfwQ0MfzxEnGCYXkUQSgfLuDepVqK6q6lkpRMJLq5R5vj4y/O5FJ0uLf5pDR4FfWHk4jG5orjdtQi+qch9E37+/2Mc4QHh4uMMLjq6BmyPinHcqi9DIUbxKXCjtvm7CaWrKPBfeQrSX2BBzY=
        # FIREBASE_AUTH_DOMAIN
        - secure: b95hA6vlirD+neUpc/8htd0aziakPMO2PY53Xlh2QvbnAEZKmJddVNuj5KMejnb1+mKCwzacSg2MI1OQRbSqOHysSqMPnTND1y/DENylVdKkWDuALn1fVRqwvizkw+/xZ7hNMkFNJthCG1qSfv7UJEI+7WtzWyHcFej3GhaEWAzYHZbdY7ML5cUjw2D+jb+xrdQVhjlYWVERN+NAd1g4F4edUizuzfc/VWxa1y1uY2JsnaKI8woHtbyTazRYduKWzOesa1htFXt+zGeqQhNIPYqrv2zMH5Uw4YkKYZAIRq5r1SaNkFA1v33LJfyc4CQ5DUCSDWUJW3mPKovdWQb9+dd2wQMA28LXi2bxLn/re9kTH1fqgu4ya3mWKKMESPN5aM036M+X/sq8UJTiiKanikSzudihwnfRMtEd66RBoAUv7nkqdIw2n/b+997HMOGkIMmr4xPqxydjYhlOL0RSgPfuW7OqrHXBNnig1noaq8gdZQ4PjlAKG1r+A7wJ/4wHFVXzhNMRuB/Gyq03PBflvT98kQ9XN2k4v0m38iTI4WqYUL5X6hIn27qkD2DFDDWy8qoL3Xrzyo/CxI1gH90L59VrvTsmOD8hNWahb3r513AdvlBjQR92S41Fn/PmGyMQvxBPKqceWEYSsXvNRkg7xk/En0jgE+Mmhv+XkShkHw4=
        # FIREBASE_DATABASE_URL
        - secure: HPTKPFDPrfTQnWAUVFgF7cnP4JLnHL7199xLA4YYpMvYzuESjiDDI81uhUc/DN1o4l66mPMOSZtnaMAqLWaXDodPigzRpZJvv8JjXM4M5fZKZalahpoeGwOXkO7IlRCFf9ZNsg94IXkUfEo9XsDO62lvGL13j/5UTjqAgTumoqSCwC/0luQxFtXTiaUG2aMyghadrMivBxWwnk/4uv5TmJntJsihQC4AQM4W4/nLS/UfmbC+mRouly4N5fkH2q+711y1DR79N5TmDyNAs9Y9wU/yX22CKKhdxi+ZiT+LIfKR3rubQNkcNnFshEMS2ZCRTT8GDzkJqDt57+HPGS3aIS/AB56X29MycP10qulYAu2VYGYy0uKRNTR2TnkhiVkw32U3fUaSROkXxheujkW6aJZ3BJFzra4HI1bssUyxz1BKaNswUF2+t2iwOg9MsbjNTVfNZ+reFwiP6aJlYlgDWxBrw+dLZpWmnrn+oc6w74tKOAZV8aWk7c8q32H8N1Gv9g0UN15tVFsU/2HyO2eNt3s5wDo46dwa7Jd46b0VWWuZvQIx7r+bHJAf+QYQIYqZSIBLY0wbUubAHag+nuAWqnzEJ+GIPt45Db+xQlca9Du+E+D96v/GVcQU9kCwqBDJyV74UVr9cooa8Y2BDxNec184rDgWNhiLB+Um7C7ZkPs=
        # FIREBASE_PROJECT_ID
        - secure: n3K5xViFLETYl76bTSy1U4fmZQaTXi68yYidPJOlJ4q5oOVHKrxAE0lDadekwvv5WsKymW/H8A/bNyV7hYQNMIDHOW0MFJ11zOF63fAO5BrFo8kFWnvO2CkgIn8piQwXYkS0VTV+eBuFZaaqNtlajXNs6lb8DHj5tSjatAXx2jBFNDbz2ZgPSpskj8YSI8VK7rNa+bUbVJUfnLHwcvFQOvkZd10hIDeDCZV++Nv3EeBDcf26CYWBdOy0pVAz9rSCSAxt5O4uYQP3byqtIR6PBlHo7Ck2LyoN2GCBtMvjczMumRkPv0GUFgE1OS1S4/DlxTEd/1l33aFmqBWuxQU+AFRQDMCttRR2uriQ4y7eLwIUmYyBT94BYp5d4YRA57H/lUTpmvrf4sNuXMDqimeWfGkE2Zkoccswl+bDp8o3F+ngG62C4CBl8i3eN4iNO0LfhPWIaUK5xYlEhX+uPtkICgcQduZpohjJRDDbf99i2RjnD6q4qaudBLh4yDXsZgiHxBW07Dv6x9yk4PBjc/FTVbC5tnWDMXfmrCbazxY/YcNujwlZFEjQh6Xg3z0pC4640ypK+ncU1CY5qC8sS9dHklxIau+cZWsPeetNC9gO+jFM5DonR8i5zHO6rp9SGYSbiTvMGLLgxC2FAYgBRrCrd2uh2jGUOaOHUWWsfZ3YU4Q=
        # FIREBASE_STORAGE_BUCKET
        - secure: Vs8JtZUceiGK0U12G+Je9t66a/58n7AP3h2Du8sQJdV9bWpcBybdSklEb2K1yRL48fXnECfMfNXARVVacfKlmY4mM04YxQuVCsXhTEAQU13WWr/q0CuQrV4CaRBr73C/wJxNuHH14l6VlKSjhHs2HIRdpRMGGF3c1DYXxm4u3NZWx9ERAwQBs3eHfu5B/X++4QNJYg+QEgXpfpoMvFdZlCtgh/NfPwqwDIr9+my//UEHljmU76luylpwacC5DUduRjfZCJvN6MqfmNj5iWrc1eehulZ6MJNKtBSs5XIwiohvSEFsg3FzNN7p/TD6QxRG18i1ERCP5fHSxEv/P1MM5zi9sD/3I0yx08vdEtduQfrBx7cxdigpFTc3e7AT6pavoE4zFNVuFAp9PjkEuFmPXpL8Fp8gtVU+O/0TfHv2SiESYl7Bt/19YMx3xTfKy+S7+s5JEuGyRakfNEBqZLk27tzM5xjmdaEMY24V0XXanQgotG1FrLNsQkV3o5LeyO05X0GRmQ32FYdygX7JytFIxRcAEOKB0m0UjOBJIWp1dLIZHE37SOZTH4gAm/Wuz08jlM0c+M/QwtEP4jrBuiI+wg1zgvmYPjJdAgA1BXMjP0reXP5hawC2z3g6CfQtqWpL836KQQRdH20LaoAAf8WA2TwYRijSe/0TzlKeew6tzqY=
        # FIREBASE_MESSAGING_SENDER_ID
        - secure: r0iHcrKm4ttolrXxotMcfOpAo278IJd2/UEK5mWgk3lp1fS+lpMqJ+pWST7lTVhJdxQhSMTpltkpZll/+M9ubAXZvjMiUbJiWQaSXNDGBphH6bxTAvSdfbYSFv5XAeNzpfnAl1QJ+r3FCZ00KWe3Lfkm8sP/uBCRW5PBsBSu2qKg31iB4106YlAx/K9W0BUOV+dq+Vn7UIT2Ph7kQd9nKe4CRnWWanc7XDB1BPnWG+la8XdjwLWBehr1241x8nSXZW8g5/6/tHIvNCfTVSax//3ch9Go2RbwfaDjfjRsgbPhoJw4xyLIi9OTv3+G+0EsGISaWY/nTlx80dVuGcZ1yAyeE4KjaG3henAIbZ+Khmy11sXC+mKisFiTjHzL773/whG6FKw2yDktOzVs1j+110+cI8gIskhyK7a0T0/MWTQb38puLZ0uBH4AdQ7nAIKxNtZZTwKjs+uIZbgDYeIj3KthI2dYqxox3lM+m4bCT5V0LljZ7/4h7B7MDvPzDTEaNAJ/fyCs13WXFtfaKHjHcXQWu9iBmMW2GkxYzqSyhJYj1pKerpFS/XGh2zpl3cPEeE3pZxAjRO1JAX0MemVvCa33XQR/vzPG4vsv0Rd2OQRpR67KCOp8YOsiJHXUL7fnPIDDAKl9gM3pTIYIdF+VC8KJi9B2U2zdHYmiJzACjFU=
        # GOOGLE_MAPS_KEY
        - secure: H3CNwc/ejmT2vCqmoLBqZtZGX5ELkSQ5v+h8Ro/hoR9JBZLiTEWUXwFAdZvHobhJp692c1ULlWvh2B7eKXt2X2OrFvt8rh82+HfjsKBR3q/vuJjx4YbQptdJRrOdS7gNzCGHEgboUoAkNmFgRbybwb9UyesA60k4gJUxAm0OYvdWlGVa2lB4XI34ANfz9eg4TyKM44HNmatgT154OaDiPVLtTw3bYhjEFXKHthM4wW0LRuoURV/SODstv4hqzQ9fyyqrvzJGJk8BN9hE6jHhtW+Oc7QRZaJdYVH3ZW7dNUlzvoMR8PHFAUROMg4g3JZVCiuXRrD14fgSI12k+ZInjDBh1ISi5K037QqKFMKmLOBGfp9NYXadOt9M/yTo+2lBbD0Ie19DV+n7fo+Go+CCam2UKaOzZNIf2aB/412JT0RFB+EZ0VrFJErxeYCUOF0JRE8fHdlny1jDh0hgxyeHEfxkuJsHPtalvK7ehRC6pSep5NVOSuMqdXY383ZOZVJ2yIfLR7hL/dKVKqkWNpyXiDE8Sbq+p9cbXWaIWn7RPv4BE8M4/9qQqxhLPFHd53As1ndoa3TH6At823ZtoFOTeiKZ5sgEhg9+kMpwK0FUGdtQ1wE9r56pR03EbW4D6Km9x0HFZq3u11IcCmkEqDmhxB0n2KxbgA4oalMkcT0H294=

      deploy: &firebase
        provider: firebase
        token:
          secure: TRjHL2h5/Kn0MPRMVLLgtk4HC/mWkublEJmMr6V3FyxvkWYMRcE24PqN1mHpqYAUpFW+Ex5N+G2zn/4EHysuYUhHK+n6/I2NmxS2NGK7APKzMlf7IQ6kA+lpln/nPBtK/ehHD8tOfo5aj9N3v4Oys38/5wxRVRb4/cTE3LHlYgIIOcAH2iWImezFZ5+8g9Q9AL1IX0nxiFbgZPhggj8ocuUngf/zEzLwnVnu0IY4e0LMGyaAl7vb61CaEInj1Dl3AfMWqZiurSdgmEVd/1+1MYGuP+P7hhy+uq6swhsEPfOVGj9EhGZwCq8+w2AFnpz7oi81x3ZZ8z1Rz7yJCs3xZ304WNJafAhAxehXrWI5NxCxLSQnnxiiTTWASZpwppewqqM/q/QjatoTJoE77Juyh0OfvBKSjr9SWZDfMLLMQbe6c/pLvj3dnu4h82Nfjv5yOkFS8HaNmBuCYoLnU4mYA9mBKhfUw0F3br0h1hRPCM4wYqhxUk3hvLs1OpeXrgbThkoikbZNkCZq4sT6AK8WxCBiqOQb3XWJ6P+KXjEyF3QDF0mWM8Dd9CrWDcF+Rzi611fbgX/9iQrRvTIoDLMXnz38+ruWflmYeTh5/PTFCA26/705WWMw3vMyQtaTkuYO85vSnLaRwSTCkdRNZmaT+xn7FuJoNzkCf+iGchy9s6Q=
        project: "hourofcodeua-dev"
        skip_cleanup: true
        on:
          branch: develop


    - stage: Build
      name: Build Prod
      if: branch = master
      script: yarn build
      env:
        - secure: oTxW7FJjKJ1RtI+ViJFGI+agRgLbkVqBdDBlTLfXnrcBv0PYj47AFn8KLoL/XHXF7JA7knBSZEzaTeVK9mqvzpzIOQARE9ChkVXfHFW1HvHju4NSvSc2cv6ItQXhTf2RasvIni/fscUG7E9UDlrDucnhs6AzUM34ByA1xN3KNSLixuwDljN8gUuQQ5Pim3ig7cCGLAnE2O0yLuAUAomVlWPCEDgYaH17XuHEy40kSrxHAYga2634RmE5IjAqyl2vs1i5uQiDrrXEkf2RazHDR9wuKRYDvCZRKzTwTqDWOKCpURzgWQdwgZpVa7QMmV0JIgJOBx2PN4wS0FybA+gWuJDnymZXfpgbZClvt1sezMTExFB7qA9pWFAZihKCN6Una1SA0QGPLh4RcUcV/VOHJGvaaZSaIvSrEhkXGjNJoq8naK/G/5dWP8VcLBblY//4PQfHuVphyw3dipRE2W+TKAKpuMQNZIT0qugBowASlzJXmGHH2m+YwOMi+6jy1q/3m27fnijbNMRiida6ryvhnbSeK5atfwQ0MfzxEnGCYXkUQSgfLuDepVqK6q6lkpRMJLq5R5vj4y/O5FJ0uLf5pDR4FfWHk4jG5orjdtQi+qch9E37+/2Mc4QHh4uMMLjq6BmyPinHcqi9DIUbxKXCjtvm7CaWrKPBfeQrSX2BBzY=
      deploy:
        <<: *firebase
        project: "hourofcodeua-dev"
